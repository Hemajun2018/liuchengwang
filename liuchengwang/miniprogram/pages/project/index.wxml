<!-- é¡¹ç›®é¡µé¢ -->
<view class="container">
  <!-- é¡¹ç›®åç§° -->
  <view class="project-name">{{projectInfo.name}}</view>
  
  <!-- æµç¨‹å›¾æ ‡é¢˜ -->
  <view class="flow-chart-title">
    <text class="main-title">æµç¨‹ç‹</text>
    <text class="sub-title">é¡¹ç›®æµç¨‹å›¾</text>
  </view>
  
  <!-- æµç¨‹å›¾åŒºåŸŸ -->
  <view class="flow-chart-container">
    <view class="loading-tip" wx:if="{{loading}}">åŠ è½½ä¸­...</view>
    <view class="empty-tip" wx:elif="{{nodes.length === 0}}">æš‚æ— èŠ‚ç‚¹æ•°æ®</view>
    
    <view class="flow-chart" wx:else>
      <!-- å‰ç½®æ¡ä»¶èŠ‚ç‚¹ -->
      <view class="node-container prerequisite-node" bindtap="goToPrerequisiteDetail">
        <view class="node-box {{hasPrerequisite ? 'active' : ''}}">
          <view class="node-icon">ğŸ“‹</view>
          <view class="node-title">å‰ç½®æ¡ä»¶</view>
          <view class="node-badge" wx:if="{{hasPrerequisite}}">âœ“</view>
        </view>
      </view>
      
      <!-- å‰ç½®æ¡ä»¶åˆ°ç¬¬ä¸€ç»„é—®é¢˜å’Œææ–™çš„è¿æ¥çº¿ -->
      <view class="connector-line vertical-connector">
        <view class="connector-arrow"></view>
      </view>
      
      <!-- åŠ¨æ€ç”ŸæˆèŠ‚ç‚¹åˆ—è¡¨ -->
      <block wx:for="{{nodes}}" wx:key="id" wx:for-index="index">
        <!-- é—®é¢˜å’Œææ–™è¡Œ -->
        <view class="node-row">
          <!-- é—®é¢˜èŠ‚ç‚¹ -->
          <view class="node-container issue-node" bindtap="goToNodeDetail" data-id="{{item.id}}" data-type="issue">
            <view class="node-box {{item.issues.length > 0 ? 'active' : ''}}">
              <view class="node-icon">â“</view>
              <view class="node-title">é—®é¢˜</view>
              <view class="node-count" wx:if="{{item.issues.length > 0}}">{{item.issues.length}}</view>
            </view>
            <view class="node-status-dot {{item.issues.length > 0 ? 'active' : ''}}"></view>
          </view>
          
          <!-- é—®é¢˜åˆ°ææ–™çš„æ°´å¹³è¿æ¥çº¿ - æ²¡æœ‰ç®­å¤´ -->
          <view class="horizontal-connector"></view>
          
          <!-- ææ–™èŠ‚ç‚¹ -->
          <view class="node-container material-node" bindtap="goToNodeDetail" data-id="{{item.id}}" data-type="material">
            <view class="node-box {{item.materials.length > 0 ? 'active' : ''}}">
              <view class="node-icon">ğŸ“¦</view>
              <view class="node-title">ææ–™</view>
              <view class="node-count" wx:if="{{item.materials.length > 0}}">{{item.materials.length}}</view>
            </view>
            <view class="node-status-dot {{item.materials.length > 0 ? 'active' : ''}}"></view>
          </view>
        </view>
        
        <!-- é—®é¢˜å’Œææ–™åˆ°æµç¨‹èŠ‚ç‚¹çš„è¿æ¥çº¿ -->
        <view class="connector-line vertical-connector">
          <view class="connector-arrow"></view>
        </view>
        
        <!-- æµç¨‹èŠ‚ç‚¹ -->
        <view class="node-container process-node" bindtap="goToNodeDetail" data-id="{{item.id}}">
          <view class="node-box {{item.status !== 'not_started' ? 'active' : ''}}">
            <view class="node-icon">ğŸ“</view>
            <view class="node-title">{{item.name}}</view>
            <view class="node-status-label">{{getNodeStatusText(item.status)}}</view>
          </view>
          <view class="node-status-dot {{getNodeStatusClass(item.status)}}"></view>
        </view>
        
        <!-- åªåœ¨ä¸æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œæ·»åŠ è¿æ¥çº¿åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ -->
        <view class="connector-line vertical-connector" wx:if="{{index < nodes.length - 1}}">
          <view class="connector-arrow"></view>
        </view>
      </block>
      
      <!-- æœ€åä¸€ä¸ªèŠ‚ç‚¹åˆ°æˆæœçš„è¿æ¥çº¿ -->
      <view class="connector-line vertical-connector" wx:if="{{nodes.length > 0}}">
        <view class="connector-arrow"></view>
      </view>
      
      <!-- æˆæœèŠ‚ç‚¹ -->
      <view class="node-container result-node" bindtap="goToResultDetail">
        <view class="node-box {{hasResult ? 'active' : ''}}">
          <view class="node-icon">ğŸ†</view>
          <view class="node-title">æˆæœ</view>
          <view class="node-badge" wx:if="{{hasResult}}">âœ“</view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- åº•éƒ¨æ“ä½œåŒº -->
  <view class="bottom-actions">
    <button class="action-btn logout-btn" bindtap="logout">
      <text class="btn-icon">ğŸšª</text>
      <text class="btn-text">é€€å‡ºç™»å½•</text>
    </button>
  </view>
</view> 